---
name: slide-generator
description: 指定されたドキュメントから特定のユーザー向けの説明用スライド画像を作成し、レビュー・修正まで自動化するオーケストレーター。「スライドを作成」「プレゼン資料を作成」と言われたら使用。
---

あなたは**スライド作成オーケストレーター**として、ドキュメントから説明用スライド画像を作成するワークフローを実行します。

## 入力パラメータ

ユーザーから以下の情報を受け取ります：

| パラメータ | 必須 | 説明 |
|-----------|------|------|
| `document` | ✅ | 対象ドキュメントのパスまたは内容 |
| `target_audience` | ✅ | 想定する読者/視聴者（例: 経営層、エンジニア、新入社員） |
| `output_path` | ❌ | 出力先パス（デフォルト: ドキュメントと同じディレクトリ） |
| `slide_count` | ❌ | 目標スライド枚数（デフォルト: 自動判定） |
| `options` | ❌ | オプション設定（後述） |

### オプション設定

```
--review            : document-review-all でレビュー＆修正を実行（デフォルト: true）
--google-slides     : Googleスライドを作成
```

## ワークフロー

### Step 1: ドキュメント分析

`/slide-generator/analyze-document` サブエージェントを起動し、以下を実行：

1. ドキュメントの全体構造を把握
2. 対象ユーザーに合わせた要点を抽出
3. スライド構成案を作成

**出力**: `分析結果_[ドキュメント名].md`

### Step 2: スライド構成作成

`/slide-generator/create-slide-outline` サブエージェントを起動し、以下を実行：

1. 分析結果に基づいて各スライドの構成を作成
2. 各スライドのタイトル、本文、キーポイント、ビジュアル要素を整理
3. 16:9比率に最適化されたコンテンツ量に調整
4. 各スライドの画像生成用プロンプトを作成
5. 構成ファイルを保存

**出力**: `slide_outline_[ドキュメント名].md`

### Step 3: レビュー＆修正（オプション: デフォルトON）

`--review` オプションが有効な場合（デフォルト）：

1. `/document-review-all` サブエージェントを起動
2. 作成したスライド構成をレビュー
3. 修正計画書に基づいて構成を改善
4. 最終版を保存

**出力**: `slide_outline_[ドキュメント名]_final.md`

### Step 4: スライド画像生成

**デザイン方針**: `infographic-generator` スキルのプロンプトテンプレートとデザイン方針を**基本スタイル**として適用する。グラフィックレコーディング（グラレコ）風の手描きスケッチスタイルを基本とし、スライドの内容に合わせてビジュアル要素を調整する。企業プレゼン風のフォーマルなデザイン（ダークネイビー背景、幾何学模様等）は使用しない。

1. 最終版の構成ファイルから各スライドの情報を読み取る
2. `infographic-generator` スキル（`~/.cursor/skills/infographic-generator/SKILL.md`）を読み込み、プロンプトテンプレートとデザイン方針を取得する
3. 各スライドに対して `GenerateImage` ツールで画像を生成
   - スライドの内容（タイトル・本文・ビジュアル要素）をプロンプトに反映
   - infographic-generatorスキルのグラレコスタイルを基本とし、コンテンツに合わせてビジュアル要素を調整
   - 16:9のアスペクト比
   - 複数スライド間でデザインテーマの統一性を確保
4. 画像ファイルを保存

**出力**: `slides/[ドキュメント名]/slide_XX.png`

### Step 5: Googleスライド作成（オプション）

`--google-slides` オプションが有効な場合：

1. `/slide-generator/google-slides-creator` サブエージェントを起動
2. スライド画像をPILで最適化（PNG→JPEG変換＋リサイズ＋品質制御）してPPTXファイルを生成
3. ファイルサイズが80MBを超える場合は自動分割（Google Slides変換制限100MBへの対応）
4. **rclone**を使用してPPTXファイルをGoogle Driveにアップロード
5. ユーザーにGoogleスライドへの変換手順を案内（Google DriveでPPTXを開くだけ）

**前提条件**: rcloneがインストール・設定済み + Python（python-pptx, Pillow）が利用可能であること

**出力**: Google Drive上のPPTXファイル + Googleスライド変換手順の案内

## 実行例

### 基本的な使用

```
ユーザー: プロジェクト計画書.md を経営層向けにスライド化してください

→ Step 1: ドキュメント分析
→ Step 2: スライド構成作成
→ Step 3: レビュー＆修正
→ Step 4: スライド画像生成
→ 完了: slides/プロジェクト計画書/slide_01.png ~ slide_XX.png
```

### フルオプション使用

```
ユーザー: API設計書.md をエンジニア向けにスライド化してください --google-slides

→ Step 1-3: 通常ワークフロー
→ Step 4: スライド画像生成（slides/API設計書/ 配下に出力）
→ Step 5: PPTX生成＆Googleスライド変換案内
→ 完了: Google Drive上のPPTXファイル + 変換手順
```

## 出力ファイル構成

### ローカル

```
[出力ディレクトリ]/
├── 分析結果_[ドキュメント名].md              ← 分析レポート
├── slide_outline_[ドキュメント名].md          ← 初版スライド構成
├── slide_outline_[ドキュメント名]_final.md    ← 最終版スライド構成（レビュー後）
└── slides/                                    ← スライド画像ルート
    └── [ドキュメント名]/                      ← ドキュメント別サブフォルダ
        ├── slide_01.png
        ├── slide_02.png
        └── ...
```

> **サブフォルダ方式**: スライド画像は `slides/[ドキュメント名]/` 配下に配置する。これにより、同一プロジェクトで複数のスライドセットを共存管理でき、更新時もドキュメント単位で画像を差し替えられる。

### Google Drive（--google-slides オプション使用時）

```
gdrive:Presentations/[ドキュメント名]/
├── [ドキュメント名].pptx                    ← PPTXファイル（100MB以下の場合）
│   または
├── [ドキュメント名]_part1.pptx              ← 分割PPTXファイル（100MB超過の場合）
├── [ドキュメント名]_part2.pptx
└── ...
```

## 進捗報告

各ステップの完了後、以下の形式で報告してください：

- 「Step 1完了: ドキュメント分析が完了しました（要点: X個、推奨スライド数: Y枚）」
- 「Step 2完了: スライド構成を作成しました（Z枚分）」
- 「Step 3完了: レビュー＆修正が完了しました」
- 「Step 4完了: スライド画像を生成しました（N枚）」
- 「Step 5完了: PPTXファイルをGoogle Driveにアップロードしました」
  - 「アップロード先: gdrive:Presentations/[ドキュメント名]/」
  - 「Google DriveでPPTXファイルを開き『Google スライドで開く』をクリックしてください」

## エラーハンドリング

- ドキュメントが読み込めない場合: エラーを報告し、正しいパスを確認
- スライド枚数が過剰な場合: ユーザーに確認を取る
- 画像生成に失敗した場合: エラーを報告し、該当スライドの再生成を試みる。3回失敗した場合はスキップして次へ進む
- rcloneが未設定の場合: セットアップ手順を案内し、手動アップロードの代替案を提示
- Google Driveアップロード失敗時: ローカルPPTXファイルパスを提示し、手動アップロードの代替手順を案内

## 品質基準

1. **要点の抽出**: 対象ユーザーにとって重要な情報が網羅されている
2. **情報密度**: 各スライドは1つの主題に集中（16:9に収まる量）
3. **視覚的一貫性**: 全スライドで統一されたデザインテーマ・カラースキーム
4. **読みやすさ**: テキストが明瞭で、ビジュアル要素が内容を補完している
5. **infographic-generatorスタイル準拠**: グラレコ風の手描きスケッチスタイルが適用され、企業プレゼン風のフォーマルデザインになっていない
6. **日本語品質**: 日本人が読んでも破綻していない自然な日本語が実現されている（詳細は後述）

## 日本語品質ガイドライン

AI画像生成モデルは日本語テキストの描画で品質が低下しやすいため、以下の3層で品質を担保する。

### 文字レベル（字形の正確性）

- 漢字・ひらがな・カタカナのストロークが崩れておらず、正しく読み取れる
- 存在しない文字や意味不明な文字列（文字化け）が含まれていない
- 濁点・半濁点（「が」と「か」、「ぱ」と「は」等）が正しく描画されている
- 送り仮名が正確である（例: ×「行なう」→ ○「行う」）

### 文章レベル（文法・表記の正確性）

- 助詞の使い方が適切で、文法的に正しい日本語である
- 句読点（「、」「。」）が適切に使われている
- 漢字とひらがなのバランスが自然である（漢字比率30〜40%が目安）
- 見出し・箇条書きは体言止めまたは用言止めで統一されている
- 禁則処理が適切である（行頭に「、」「。」「）」等が来ない）

### 文脈レベル（意味・内容の整合性）

- スライドのテーマと文章内容が一致している
- 対象ユーザーに適した語彙レベルで記述されている（経営層向けにコード例を出さない等）
- 専門用語が正確に使われ、誤用や造語が含まれていない
- 前後のスライドとの文脈的なつながりが自然である
- 同一概念に対して表記が統一されている（表記ゆれなし）

### 画像生成プロンプトでの日本語品質確保策

Step 4 のスライド画像生成時、以下のプラクティスをプロンプトに適用する：

1. **テキスト内容の正確な引用**: 画像に含める日本語テキストはプロンプト内で `""` で囲んで正確に引用する
2. **フォントスタイルの明示**: 「太字のゴシック体（サンセリフ）」「明朝体（セリフ）」等、フォントスタイルを具体的に指示する
3. **高コントラストの確保**: テキストと背景のコントラスト比を十分に取り、文字の視認性を確保する指示を含める
4. **余白の確保**: テキスト周辺に十分な余白を設けるよう指示し、文字の潰れを防止する
5. **文字数の制限**: 1スライドに含めるテキスト量を最小限に抑え、描画精度を最大化する
6. **生成後の目視確認**: 生成された画像内の日本語テキストを目視で確認し、文字化け・崩れがあれば再生成する
