---
description: AI Scrum FrameworkのSP（ストーリーポイント）見積もり基準。プロジェクト横断で適用する。タスクの見積もり・プランニング・キャリブレーション時に参照。
globs:
  - "**/tasks.md"
  - "**/milestones.md"
  - "**/sprint-backlog.md"
  - "**/product-backlog.md"
alwaysApply: false
---

# ストーリーポイント見積もりガイド

> AI前提のスプリント開発におけるSP見積もり基準。
> プロジェクト横断で使用する共通ルール。

---

## 1. SP Scale（基本スケール）

修正フィボナッチ数列（1, 2, 3, 5, 8, 13）を使用する。

| SP | レベル | 定義 | AIにとっての意味 | 代表的な具体例 |
|----|--------|------|----------------|---------------|
| 1 | 極めて単純 | 判断不要の定型変更 | 単一ファイル、1箇所の変更。パターン踏襲 | typo修正、定数値変更、コメント追加 |
| 2 | 単純 | 軽微な判断を伴う小さな変更 | 1〜2ファイル、限定的な影響範囲 | 既存関数の引数追加、テンプレートの軽微修正、Commandファイル作成 |
| 3 | やや複雑 | 設計判断を伴う中規模の変更 | 2〜5ファイル、既存パターンの応用 | 新規関数追加、テンプレート新規作成、既存Skillの機能拡張 |
| 5 | 複雑 | 複数の設計判断を伴う大きな変更 | 5ファイル以上、新規パターンの導入 | 新規Subagent作成、新規Skill作成、ワークフロー拡張 |
| 8 | 非常に複雑 | アーキテクチャレベルの判断を伴う | 多数ファイル、システム全体への影響 | 新フレームワーク機能、複数Agent/Skill連携設計 |
| 13 | 極めて複雑 | セッション占有レベルの大規模変更 | PO確認多数、複数フェーズの設計判断 | システム全体の設計変更、大規模リファクタリング |

### 使い方

- **見積もりは相対的**: SP 3はSP 1の「3倍の時間」ではなく「3倍の複雑さ」を意味する
- **不確実性を含む**: SP 5は「確実に5の労力」ではなく「5程度の複雑さと不確実性」を表す
- **迷ったら大きい方**: SP 3かSP 5か迷ったらSP 5を選ぶ（楽観バイアスの防止）

---

## 2. 見積もり4軸（Multi-Dimensional Assessment）

SPは単一の数値だが、以下の4軸を総合的に評価して決定する。

### 軸1: 技術的複雑度（Complexity）

| レベル | 説明 | SP目安 |
|--------|------|--------|
| Low | 既存パターンの踏襲。判断不要 | 1〜2 |
| Medium | 既存パターンの応用。軽微な設計判断 | 3 |
| High | 新規パターンの導入。複数の設計判断 | 5〜8 |
| Very High | アーキテクチャ変更。システム全体に影響 | 8〜13 |

### 軸2: スコープ（Scope）

| レベル | ファイル数 | 変更行数目安 | SP目安 |
|--------|-----------|------------|--------|
| Minimal | 1 | 〜10行 | 1 |
| Small | 1〜2 | 〜50行 | 2 |
| Medium | 2〜5 | 〜200行 | 3〜5 |
| Large | 5〜10 | 〜500行 | 5〜8 |
| Very Large | 10+ | 500行+ | 8〜13 |

### 軸3: 不確実性（Uncertainty）

| レベル | 説明 | SP補正 |
|--------|------|--------|
| Known | 類似タスクの実績あり。手順が明確 | そのまま |
| Partially Known | 概ね手順は分かるが、一部調査が必要 | +1段階検討 |
| Unknown | 新技術・未経験領域。リサーチ必須 | +1〜2段階 |

### 軸4: PO依存度（PO Dependency）

| レベル | 説明 | SP補正 |
|--------|------|--------|
| None | AIが自律的に完了可能 | そのまま |
| Confirmation | 完了時にPO確認が1回必要 | そのまま |
| Decision | 途中でPOの設計判断が必要（1〜2回） | +1段階検討 |
| Heavy | PO判断が3回以上。方針確認を繰り返す | +1〜2段階 |

### 総合評価の方法

1. 4軸それぞれでレベルを判定する
2. 最も高いレベルの軸をベースSPとする
3. 他の軸で高レベルが2つ以上あれば、1段階上げることを検討する
4. 最終的にフィボナッチ値（1, 2, 3, 5, 8, 13）に丸める

---

## 3. 見積もりプロセス

### ステップ

1. **タスク内容の確認**: 完了条件・成果物・依存関係を把握
2. **4軸評価**: 複雑度・スコープ・不確実性・PO依存度を判定
3. **パターンマッチング**: Section 4のタスクパターンと照合
4. **仮SP決定**: 4軸評価 + パターンマッチングから仮のSPを決める
5. **自己批判**: 「この見積もりが外れるとしたら、なぜか？」を自問
6. **最終SP確定**: 自己批判の結果を反映して最終SPを決定
7. **根拠記録**: SPの根拠を備考に簡潔に記録（1行）

### 見積もりの記録フォーマット

```
SP {値} — {主要根拠}（4軸: C={Low/Med/High/VHigh}, S={Min/Sm/Med/Lg/VLg}, U={Known/PK/Unk}, PO={None/Conf/Dec/Heavy}）
```

例: `SP 3 — 既存パターン応用の新規テンプレート作成（4軸: C=Med, S=Med, U=Known, PO=Conf）`

---

## 4. タスクパターン（実績ベースリファレンス）

> 過去スプリント（SPRINT-002〜008）の実績データに基づく。

### ドキュメント系

| パターン | 典型SP | 実績例 |
|---------|--------|--------|
| テンプレート新規作成（.md） | 2〜3 | sprint-backlog.md(2), sprint-log.md(2), try-stock.md(2) |
| ルール新規作成（.mdc） | 3〜5 | sprint-workflow.mdc(5), commit-discipline.mdc(3) |
| 既存ドキュメントの追記・修正 | 1〜2 | workflow.mdcセクション追加(2), テンプレート修正(1) |
| ガイド・レポート作成 | 2〜3 | quickstart-guide(3), bootstrap-report(2) |

### Agent/Skill系

| パターン | 典型SP | 実績例 |
|---------|--------|--------|
| Subagent新規作成 | 5 | sprint-planner(5), sprint-review-runner(5), sprint-retro(5) |
| Skill新規作成 | 3〜5 | po-assistant(3), sprint-coder(3), sprint-documenter(3) |
| 既存Agent/Skillの機能拡張 | 2〜3 | sprint-planner拡張(2), sprint-coder拡張(3) |
| Command新規作成 | 2 | /sprint-start(2), /sprint-status(2), /sprint-end(2) |

### テスト・検証系

| パターン | 典型SP | 実績例 |
|---------|--------|--------|
| 結合テスト（一連動作検証） | 5 | M1結合テスト(5) |
| 個別機能テスト | 3 | ログ記録テスト(3) |

### プロセス改善系

| パターン | 典型SP | 実績例 |
|---------|--------|--------|
| ワークフローへのルール追加 | 2 | rsync/commitルール追加(2), KPTステップ追加(2) |
| リファインメント実施 | 3〜5 | 全件リファインメント(5), 部分リファインメント(3) |

---

## 5. キャリブレーション（精度追跡）

### 目的

見積もりSPと実績を比較し、見積もり精度を継続的に改善する。

### 追跡指標

| 指標 | 計算方法 | 目標値 |
|------|---------|--------|
| SP消化率 | 完了SP / 計画SP × 100 | 80〜100% |
| 見積もり正確度 | 計画通りに完了したタスクの割合 | 80%以上 |
| オーバー見積もり率 | 実際より大きく見積もったタスクの割合 | 20%以下 |
| アンダー見積もり率 | 実際より小さく見積もったタスクの割合 | 10%以下 |

### キャリブレーションのタイミング

- **毎スプリント**: レトロスペクティブで各タスクの見積もり精度を振り返る
- **5スプリントごと**: タスクパターン（Section 4）の実績値を更新する
- **新タスクパターン発見時**: Section 4に追加する

### 乖離時の対応

| 乖離 | 判定基準 | 対応 |
|------|---------|------|
| 過小見積もり | 実際の複雑さがSP+2段階以上 | 不確実性軸の評価を見直す |
| 過大見積もり | 3スプリント連続で余裕をもって完了 | スコープ軸の基準を見直す |
| パターン不一致 | 同種タスクのSPが毎回異なる | タスク定義の粒度を標準化する |

---

## 6. アンチパターン（避けるべき見積もりミス）

| # | アンチパターン | 説明 | 対策 |
|---|--------------|------|------|
| 1 | **楽観バイアス** | 「AIだからすぐできる」と過小評価 | 4軸評価を必ず実施。不確実性を正直に評価 |
| 2 | **アンカリング** | 前回のSPに引きずられる | タスク内容を先に評価してからパターンと照合 |
| 3 | **粒度無視** | SP 1のタスクとSP 8のタスクを同列に扱う | Flower適用レベル（ライト/スタンダード/フル）を確認 |
| 4 | **スコープクリープ放置** | 「ついでに」の追加作業をSPに反映しない | スコープ変更は明示的に記録し、SP再見積もり |
| 5 | **PO依存の軽視** | PO判断の待ち時間を考慮しない | PO依存度軸で適切に評価 |
| 6 | **コピペ見積もり** | 類似タスクのSPをそのままコピー | 4軸で個別に評価してからパターンと比較 |

---

## 7. Flower 5段階モデルとの連携

SP値によってFlowerモデルの適用レベルが決まる。見積もり時にこの対応を意識する。

| SP範囲 | Flower適用レベル | Research | Learn | Plan | Code | Review |
|--------|----------------|----------|-------|------|------|--------|
| 1〜2 | ライト | スキップ可 | スキップ可 | 簡易 | 実装 | 簡易チェック |
| 3〜5 | スタンダード | 実施 | PO判断 | 詳細 | PGTR反復 | フルチェック |
| 8〜13 | フル | 必須 | 必須 | 詳細+自己批判 | PGTR反復 | フルチェック+セキュリティ |

### 見積もりへの影響

- **SP 3以上ではResearchフェーズが発生** → 調査時間を見積もりに含める
- **SP 8以上ではPO Learn必須** → PO対話のオーバーヘッドを考慮
- **SP 5以上ではPGTR反復が前提** → 反復回数を予測に含める

---

## 8. クイックリファレンス（見積もりチートシート）

迷ったときの即判定ガイド:

```
Q1: ファイル数は？
  1ファイル → SP 1〜2
  2〜5ファイル → SP 3〜5
  6ファイル以上 → SP 5〜13

Q2: 新しいパターン？
  既存パターン踏襲 → そのまま
  新規パターン導入 → +1段階

Q3: リサーチが必要？
  不要 → そのまま
  必要 → +1段階

Q4: PO判断は何回？
  0〜1回 → そのまま
  2回以上 → +1段階
```

---

## 更新履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2026-02-11 | 1.0 | 初版作成（SPRINT-009 T101）。Phase 1簡易版を拡張し、4軸評価・タスクパターン・キャリブレーションルールを追加 |
