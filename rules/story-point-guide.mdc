---
description: AI Scrum FrameworkのSP（ストーリーポイント）見積もり基準。プロジェクト横断で適用する。タスクの見積もり・プランニング・キャリブレーション時に参照。
globs:
  - "**/tasks.md"
  - "**/milestones.md"
  - "**/sprint-backlog.md"
  - "**/product-backlog.md"
alwaysApply: false
---

# ストーリーポイント見積もりガイド

> AI前提のスプリント開発におけるSP見積もり基準。
> プロジェクト横断で使用する共通ルール。

---

## 1. SP Scale（基本スケール）

修正フィボナッチ数列（1, 2, 3, 5, 8, 13）を使用する。

| SP | レベル | 定義 | AIにとっての意味 | 代表的な具体例 |
|----|--------|------|----------------|---------------|
| 1 | 極めて単純 | 判断不要の定型変更 | 単一ファイル、1箇所の変更。パターン踏襲 | typo修正、定数値変更、コメント追加 |
| 2 | 単純 | 軽微な判断を伴う小さな変更 | 1〜2ファイル、限定的な影響範囲 | 既存関数の引数追加、テンプレートの軽微修正、Commandファイル作成 |
| 3 | やや複雑 | 設計判断を伴う中規模の変更 | 2〜5ファイル、既存パターンの応用 | 新規関数追加、テンプレート新規作成、既存Skillの機能拡張 |
| 5 | 複雑 | 複数の設計判断を伴う大きな変更 | 5ファイル以上、新規パターンの導入 | 新規Subagent作成、新規Skill作成、ワークフロー拡張 |
| 8 | 非常に複雑 | アーキテクチャレベルの判断を伴う | 多数ファイル、システム全体への影響 | 新フレームワーク機能、複数Agent/Skill連携設計 |
| 13 | 極めて複雑 | セッション占有レベルの大規模変更 | PO確認多数、複数フェーズの設計判断 | システム全体の設計変更、大規模リファクタリング |

### 使い方

- **見積もりは相対的**: SP 3はSP 1の「3倍の時間」ではなく「3倍の複雑さ」を意味する
- **不確実性を含む**: SP 5は「確実に5の労力」ではなく「5程度の複雑さと不確実性」を表す
- **迷ったら大きい方**: SP 3かSP 5か迷ったらSP 5を選ぶ（楽観バイアスの防止）

---

## 2. 見積もり4軸（Multi-Dimensional Assessment）

SPは単一の数値だが、以下の4軸を総合的に評価して決定する。

### 軸1: 技術的複雑度（Complexity）

| レベル | 説明 | SP目安 |
|--------|------|--------|
| Low | 既存パターンの踏襲。判断不要 | 1〜2 |
| Medium | 既存パターンの応用。軽微な設計判断 | 3 |
| High | 新規パターンの導入。複数の設計判断 | 5〜8 |
| Very High | アーキテクチャ変更。システム全体に影響 | 8〜13 |

### 軸2: スコープ（Scope）

| レベル | ファイル数 | 変更行数目安 | SP目安 |
|--------|-----------|------------|--------|
| Minimal | 1 | 〜10行 | 1 |
| Small | 1〜2 | 〜50行 | 2 |
| Medium | 2〜5 | 〜200行 | 3〜5 |
| Large | 5〜10 | 〜500行 | 5〜8 |
| Very Large | 10+ | 500行+ | 8〜13 |

### 軸3: 不確実性（Uncertainty）

| レベル | 説明 | SP補正 |
|--------|------|--------|
| Known | 類似タスクの実績あり。手順が明確 | そのまま |
| Partially Known | 概ね手順は分かるが、一部調査が必要 | +1段階検討 |
| Unknown | 新技術・未経験領域。リサーチ必須 | +1〜2段階 |

### 軸4: PO依存度（PO Dependency）

| レベル | 説明 | SP補正 |
|--------|------|--------|
| None | AIが自律的に完了可能 | そのまま |
| Confirmation | 完了時にPO確認が1回必要 | そのまま |
| Decision | 途中でPOの設計判断が必要（1〜2回） | +1段階検討 |
| Heavy | PO判断が3回以上。方針確認を繰り返す | +1〜2段階 |

### 総合評価の方法

1. 4軸それぞれでレベルを判定する
2. 最も高いレベルの軸をベースSPとする
3. 他の軸で高レベルが2つ以上あれば、1段階上げることを検討する
4. 最終的にフィボナッチ値（1, 2, 3, 5, 8, 13）に丸める

---

## 3. 見積もりプロセス

### ステップ

1. **タスク内容の確認**: 完了条件・成果物・依存関係を把握
2. **4軸評価**: 複雑度・スコープ・不確実性・PO依存度を判定
3. **パターンマッチング**: Section 4のタスクパターンと照合
4. **仮SP決定**: 4軸評価 + パターンマッチングから仮のSPを決める
5. **自己批判**: 「この見積もりが外れるとしたら、なぜか？」を自問
6. **最終SP確定**: 自己批判の結果を反映して最終SPを決定
7. **根拠記録**: SPの根拠を備考に簡潔に記録（1行）

### 見積もりの記録フォーマット

```
SP {値} — {主要根拠}（4軸: C={Low/Med/High/VHigh}, S={Min/Sm/Med/Lg/VLg}, U={Known/PK/Unk}, PO={None/Conf/Dec/Heavy}）
```

例: `SP 3 — 既存パターン応用の新規テンプレート作成（4軸: C=Med, S=Med, U=Known, PO=Conf）`

---

## 4. タスクパターン（実績ベースリファレンス）

> 過去スプリント（SPRINT-002〜008）の実績データに基づく。

### ドキュメント系

| パターン | 典型SP | 実績例 |
|---------|--------|--------|
| テンプレート新規作成（.md） | 2〜3 | sprint-backlog.md(2), sprint-log.md(2), try-stock.md(2) |
| ルール新規作成（.mdc） | 3〜5 | sprint-workflow.mdc(5), commit-discipline.mdc(3) |
| 既存ドキュメントの追記・修正 | 1〜2 | workflow.mdcセクション追加(2), テンプレート修正(1) |
| ガイド・レポート作成 | 2〜3 | quickstart-guide(3), bootstrap-report(2) |

### Agent/Skill系

| パターン | 典型SP | 実績例 |
|---------|--------|--------|
| Subagent新規作成 | 5 | sprint-planner(5), sprint-review-runner(5), sprint-retro(5) |
| Skill新規作成 | 3〜5 | po-assistant(3), sprint-coder(3), sprint-documenter(3) |
| 既存Agent/Skillの機能拡張 | 2〜3 | sprint-planner拡張(2), sprint-coder拡張(3) |
| Command新規作成 | 2 | /sprint-start(2), /sprint-status(2), /sprint-end(2) |

### テスト・検証系

| パターン | 典型SP | 実績例 |
|---------|--------|--------|
| 結合テスト（一連動作検証） | 5 | M1結合テスト(5) |
| 個別機能テスト | 3 | ログ記録テスト(3) |

### プロセス改善系

| パターン | 典型SP | 実績例 |
|---------|--------|--------|
| ワークフローへのルール追加 | 2 | rsync/commitルール追加(2), KPTステップ追加(2) |
| リファインメント実施 | 3〜5 | 全件リファインメント(5), 部分リファインメント(3) |

---

## 5. キャリブレーション（精度追跡）

### 目的

見積もりSPと実績を比較し、見積もり精度を継続的に改善する。
スプリントごとにSP精度データを蓄積し、定期的なキャリブレーションで見積もり基準を調整する。

### 5.1 SP精度追跡フレームワーク

SP精度追跡は**レトロスペクティブの自然な延長**として運用する。外部ツール・DB不要で、Markdownテーブルで完結する。

```
見積もり時                スプリント実行           レトロスペクティブ
┌─────────────┐     ┌────────────────┐     ┌─────────────────────┐
│ 4軸評価で    │     │ タスクを実際に │     │ 見積もりSPと実感SPの │
│ SP見積もり   │ →   │ 実行           │ →   │ 比較・乖離分析       │
│             │     │               │     │ sprint-log.mdに記録  │
└─────────────┘     └────────────────┘     └─────────────────────┘
                                                     │
                                                     ▼
                                           ┌─────────────────────┐
                                           │ 5スプリント蓄積で    │
                                           │ キャリブレーション    │
                                           │ 基準調整を検討       │
                                           └─────────────────────┘
```

#### 「実感SP」とは

タスク完了後に振り返って「実際の複雑さ・作業量はSPいくつ相当だったか？」を主観的に再評価した値。

| 実感SPの評価基準 | 説明 |
|----------------|------|
| 見積もりSPと同じ | 見積もり通りの複雑さ・作業量だった |
| 見積もりSPより低い | 想定より単純だった（過大見積もり） |
| 見積もりSPより高い | 想定より複雑だった（過小見積もり） |

実感SPも修正フィボナッチ値（1, 2, 3, 5, 8, 13）で表す。

### 5.2 精度メトリクス定義

#### 基本指標

| 指標 | 計算方法 | 目標値 |
|------|---------|--------|
| SP消化率 | 完了SP / 計画SP × 100 | 80〜100% |
| SP一致率 | 見積もりSP = 実感SP のタスク数 / 全タスク数 × 100 | 70%以上 |
| 見積もり正確度 | 乖離が±1段階以内のタスク数 / 全タスク数 × 100 | 80%以上 |
| 過大見積もり率 | 見積もりSP > 実感SP のタスク数 / 全タスク数 × 100 | 20%以下 |
| 過小見積もり率 | 見積もりSP < 実感SP のタスク数 / 全タスク数 × 100 | 10%以下 |

> **SP一致率**と**見積もり正確度**の違い: SP一致率は「完全一致」のみカウント。見積もり正確度は隣接値（例: 見積もり3→実感2 or 5）を「許容範囲」として含む。

#### 傾向分析指標（5スプリント蓄積後）

| 指標 | 計算方法 | 用途 |
|------|---------|------|
| SP一致率トレンド | 直近5スプリントのSP一致率の推移 | 精度が改善傾向か悪化傾向かを判断 |
| パターン別精度 | タスクパターン（Section 4）ごとのSP一致率 | 見積もりが弱いパターンを特定 |
| 過大/過小バイアス | 過大見積もり率 − 過小見積もり率 | 系統的なバイアスの有無を検出 |

### 5.3 記録フォーマット（sprint-log.md用）

各スプリントのレトロスペクティブで、sprint-log.md の「SP精度記録」セクションに以下を記録する。

#### タスク別SP精度テーブル

```markdown
| タスクID | タスク名 | 見積もりSP | 実感SP | 乖離 | 乖離理由 |
|---------|---------|-----------|--------|------|---------|
| T-xxx | {名前} | 3 | 3 | 0 | — |
| T-yyy | {名前} | 5 | 3 | -2 | 既存パターン踏襲で想定より単純だった |
| T-zzz | {名前} | 2 | 3 | +1 | 依存ファイルの調査が想定外に必要だった |
```

乖離の計算: `実感SP − 見積もりSP`
- `0`: 正確（一致）
- マイナス値: 過大見積もり（実際は簡単だった）
- プラス値: 過小見積もり（実際は難しかった）

#### SP精度サマリー

```markdown
| 指標 | 値 | 目標 | 判定 |
|------|-----|------|------|
| SP一致率 | {n}% | 70%以上 | ✅ / ⚠️ / ❌ |
| 見積もり正確度（±1段階） | {n}% | 80%以上 | ✅ / ⚠️ / ❌ |
| 過大見積もり率 | {n}% | 20%以下 | ✅ / ⚠️ / ❌ |
| 過小見積もり率 | {n}% | 10%以下 | ✅ / ⚠️ / ❌ |
| 過大/過小バイアス | {n}% | — | 傾向メモ |
```

判定基準:
- ✅ 目標達成
- ⚠️ 目標未達だが改善傾向
- ❌ 目標未達かつ悪化傾向

#### キャリブレーション要否

```markdown
| チェック項目 | 結果 | 判定 |
|------------|------|------|
| SP一致率が70%未満か | Yes / No | 要キャリブレーション / — |
| 5スプリント蓄積に達したか | Yes / No | 定期キャリブレーション / — |
| 特定パターンで3回連続乖離か | Yes / No | パターン別キャリブレーション / — |
```

### 5.4 キャリブレーションのタイミング

| トリガー | 条件 | 実施内容 |
|---------|------|---------|
| **毎スプリント** | レトロスペクティブ実施時 | 各タスクの見積もりSPと実感SPを比較・記録 |
| **定期キャリブレーション** | 5スプリント蓄積ごと | タスクパターン（Section 4）の実績値を更新、4軸基準の調整検討 |
| **緊急キャリブレーション** | SP一致率が70%を下回った場合 | 乖離原因の分析、該当する軸の基準を即時調整 |
| **パターン別キャリブレーション** | 同一パターンで3回連続乖離 | 当該パターンの典型SPを実績に基づいて更新 |
| **新パターン発見時** | Section 4に該当なし | Section 4に新パターンとして追加 |

### 5.5 キャリブレーション実行手順

> **自動化**: キャリブレーションの実行は sprint-retro.md **Step 5.6** で自動的にトリガーされる。
> Step 5.5（4）のトリガーチェックで条件に該当した場合、Step 5.6 でデータ収集・傾向分析・調整提案の生成が自動実行され、PO確認・適用ステップに進む。

#### 定期キャリブレーション（5スプリントごと）

```
Step 1: データ収集（sprint-retro Step 5.6 (2) で自動実行）
    直近5スプリントのsprint-log.md「SP精度記録」セクションを収集

Step 2: 全体精度評価（sprint-retro Step 5.6 (3) で自動実行）
    SP一致率・見積もり正確度・過大/過小見積もり率を集計
    過大/過小バイアスの傾向を特定

Step 3: パターン別分析（sprint-retro Step 5.6 (3) で自動実行）
    タスクパターン（Section 4）ごとに精度を集計
    精度が低い（一致率50%未満）パターンを特定

Step 4: 調整提案の生成（sprint-retro Step 5.6 (4) で自動実行）
    ─ 系統的な過大バイアス → スコープ軸の基準を引き下げ検討
    ─ 系統的な過小バイアス → 不確実性軸の評価を厳格化検討
    ─ パターン別乖離 → Section 4の典型SPを実績値に更新
    ─ 4軸評価のどの軸で乖離が大きいかを特定し、該当軸を調整

Step 5: PO確認・適用（sprint-retro Step 5.6 (5) でPOに提示）
    POが「適用して」→ 本ファイルの該当セクション + 更新履歴を更新
    POが「次回で」→ Tryとして登録（優先度High）
    POが「不要」→ ログに「キャリブレーション提案棄却」と記録

Step 6: 結果記録
    story-point-guide.mdc の更新履歴に調整内容を記録
    Section 5.8 キャリブレーション結果記録テーブルを更新
    次スプリントのプランニングで調整後の基準を適用
```

#### 緊急キャリブレーション（精度70%未満時）

```
Step 1: 直近スプリントの全タスク乖離を精査
Step 2: 乖離が大きいタスク（±2段階以上）の共通要因を分析
Step 3: 以下のいずれかを実施:
    ─ 4軸評価の基準調整（該当軸の閾値変更）
    ─ タスクパターンの典型SP更新
    ─ アンチパターンの追加（Section 6）
Step 4: 調整内容をtry-stock.mdのTryとしても記録（追跡のため）
```

#### パターン別キャリブレーション（同一パターン3回連続乖離時）

```
Step 1: 該当パターンの直近3スプリント分のSPデータを収集
Step 2: 乖離の方向（過大/過小）と大きさを確認
Step 3: Section 4の該当パターンの典型SPを実績平均に更新
Step 4: 更新内容を Section 5.8 に記録
```

### 5.6 乖離時の対応

| 乖離パターン | 判定基準 | 対応 |
|------------|---------|------|
| 過小見積もり（実感 > 見積もり） | 実感SPが見積もりSP+2段階以上 | 不確実性軸の評価を見直す |
| 過大見積もり（実感 < 見積もり） | 3スプリント連続で余裕をもって完了 | スコープ軸の基準を見直す |
| パターン不一致 | 同種タスクのSPが毎回異なる | タスク定義の粒度を標準化する |
| 系統的バイアス | 過大/過小バイアスが±15%以上 | 全体的な見積もり傾向を調整 |

### 5.7 精度追跡の運用ルール（★SPRINT-031 T202で追記を含む）

1. **記録は必須**: 全スプリントで「SP精度記録」セクションをsprint-log.mdに記録する（省略不可）
2. **実感SPは正直に**: 楽観・悲観バイアスを避け、実際の作業感覚に基づいて評価する
3. **乖離理由は具体的に**: 「難しかった」ではなく「依存ファイルの調査が想定外に必要だった」等
4. **軽量運用**: 記録に10分以上かけない。レトロスペクティブの一部として自然に実施する
5. **段階的改善**: 最初の5スプリントはデータ蓄積期間。精度が低くても基準調整は慎重に行う

### 5.8 キャリブレーション結果記録（★SPRINT-031 T202で追加）

キャリブレーションが実施されるたびに、以下のテーブルに結果を追記する。

| # | Sprint | 種別 | トリガー条件 | 調整内容 | PO判断 | 効果（次5Sprint精度変化） |
|---|--------|------|------------|---------|--------|------------------------|
| — | （キャリブレーション実施時にここに追記される） | | | | | |

> **記録タイミング**: sprint-retro Step 5.6 (6) で自動記録される
> **効果測定**: 調整適用後5スプリント経過時に、調整前後のSP一致率を比較して効果を記入
> **種別**: 定期 / 緊急 / パターン別

---

## 6. アンチパターン（避けるべき見積もりミス）

| # | アンチパターン | 説明 | 対策 |
|---|--------------|------|------|
| 1 | **楽観バイアス** | 「AIだからすぐできる」と過小評価 | 4軸評価を必ず実施。不確実性を正直に評価 |
| 2 | **アンカリング** | 前回のSPに引きずられる | タスク内容を先に評価してからパターンと照合 |
| 3 | **粒度無視** | SP 1のタスクとSP 8のタスクを同列に扱う | Flower適用レベル（ライト/スタンダード/フル）を確認 |
| 4 | **スコープクリープ放置** | 「ついでに」の追加作業をSPに反映しない | スコープ変更は明示的に記録し、SP再見積もり |
| 5 | **PO依存の軽視** | PO判断の待ち時間を考慮しない | PO依存度軸で適切に評価 |
| 6 | **コピペ見積もり** | 類似タスクのSPをそのままコピー | 4軸で個別に評価してからパターンと比較 |

---

## 7. Flower 5段階モデルとの連携

SP値によってFlowerモデルの適用レベルが決まる。見積もり時にこの対応を意識する。

| SP範囲 | Flower適用レベル | Research | Learn | Plan | Code | Review |
|--------|----------------|----------|-------|------|------|--------|
| 1〜2 | ライト | スキップ可 | スキップ可 | 簡易 | 実装 | 簡易チェック |
| 3〜5 | スタンダード | 実施 | PO判断 | 詳細 | PGTR反復 | フルチェック |
| 8〜13 | フル | 必須 | 必須 | 詳細+自己批判 | PGTR反復 | フルチェック+セキュリティ |

### 見積もりへの影響

- **SP 3以上ではResearchフェーズが発生** → 調査時間を見積もりに含める
- **SP 8以上ではPO Learn必須** → PO対話のオーバーヘッドを考慮
- **SP 5以上ではPGTR反復が前提** → 反復回数を予測に含める

---

## 8. クイックリファレンス（見積もりチートシート）

迷ったときの即判定ガイド:

```
Q1: ファイル数は？
  1ファイル → SP 1〜2
  2〜5ファイル → SP 3〜5
  6ファイル以上 → SP 5〜13

Q2: 新しいパターン？
  既存パターン踏襲 → そのまま
  新規パターン導入 → +1段階

Q3: リサーチが必要？
  不要 → そのまま
  必要 → +1段階

Q4: PO判断は何回？
  0〜1回 → そのまま
  2回以上 → +1段階
```

---

## 更新履歴

| 日付 | バージョン | 変更内容 |
|------|-----------|---------|
| 2026-02-13 | 1.2 | Section 5.5 自動化連携追加、Section 5.8 キャリブレーション結果記録テーブル追加、パターン別キャリブレーション手順追加（SPRINT-031 T202）。sprint-retro Step 5.6 と連動して自動キャリブレーションが可能に |
| 2026-02-12 | 1.1 | Section 5 拡張（SPRINT-023 S023-2 / TRY-018）。SP精度追跡フレームワーク・精度メトリクス定義・記録フォーマット・キャリブレーション実行手順を追加 |
| 2026-02-11 | 1.0 | 初版作成（SPRINT-009 T101）。Phase 1簡易版を拡張し、4軸評価・タスクパターン・キャリブレーションルールを追加 |
